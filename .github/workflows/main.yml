name: bhyvemgr test

on:
  push:
    paths-ignore:
      - '**/LICENSE'
      - '**/README.md'
    branches:
      - "**"
  pull_request:
    branches:
      - master
      - main
      
jobs:
  test:
    runs-on: ubuntu-latest
    name: A job to run test in FreeBSD
    steps:
    - uses: actions/checkout@v5
    - name: bhyvemgr testing on FreeBSD VM
      id: test
      uses: vmactions/freebsd-vm@v1.2.4
      with:
        release: "14.3"
        usesh: true
        prepare: |
          mkdir -p /usr/local/etc/pkg/repos
          echo "FreeBSD: { url: "pkg+http://pkg.freebsd.org/\${ABI}/latest" }" \
              > /usr/local/etc/pkg/repos/FreeBSD.conf        
          export IGNORE_OSVERSION=yes
          pkg update -f
          pkg install -y lazarus-qt6

        run: |
          set -e -x
          chmod +x build.sh
           ./build.sh release qt6
          pkg remove -y lazarus-qt6
          pkg install -y lazarus-qt5
          ./build.sh release qt5
          pkg remove -y lazarus-qt5
          pkg install -y lazarus-gtk2
          ./build.sh release gtk2
